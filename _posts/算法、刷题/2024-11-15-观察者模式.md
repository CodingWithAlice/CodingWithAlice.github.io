---
layout:     post
title:      观察者模式
subtitle:  
date:       2024-11-15
author:     
header-img: 
catalog: true
tags:
    - < 算法题 >
typora-root-url: ..
---

## 观察者模式

 手动实现 `EventEmitter`

```js
// addListener(event, listener) 为指定事件添加一个监听器，默认添加到监听器数组的尾部。
// removeListener(event, listener) 移除指定事件的某个监听器，监听器必须是该事件已经注册过的监听器。它接受两个参数，第一个是事件名称，第二个是回调函数名称。
// once(event, listener) 为指定事件注册一个单次监听器，即 监听器最多只会触发一次，触发后立刻解除该监听器。
// emit(event, [arg1], [arg2], [...]) 按监听器的顺序执行执行每个监听器，如果事件有注册监听返回 true，否则返回 false。
//setMaxListeners(n) 默认情况下， EventEmitters 如果你添加的监听器超过 10 个就会输出警告信息。 
```

```js
class EventEmitter {
    constructor() {
        this._max = 10;
        this.eventList = {};
    }
    addListener(event, listener) {
        let exist = this.eventList[event];
        if (exist) {
            exist.push(listener);
            if (exist.length >= this._max) {
                throw Error('超过 10 个');
            }
        } else {
            exist = [listener];
        }
        this.eventList[event] = exist;
    }
    removeListener(event, listener) {
        let listeners = this.eventList[event];
        if (Array.isArray(listeners)) {
            let index = listeners.indexOf(listener);
            listeners.splice(index, 1); // 删除数组中的一项
        }
    }
    once(event, listener) {
        let exist = this.eventList[event] || [];
        let oneFun = (...args) => {
            listener(...args);
            this.removeListener(event, oneFun); // 移除 oneFun
        }
        exist.push(oneFun);
        this.eventList[event] = exist;
    }
    emit(event, ...args) {                
        let exist = this.eventList[event];
        if (!exist) { return false }
        exist.forEach(it => {
            it(...args);
        })
    }
}
```





