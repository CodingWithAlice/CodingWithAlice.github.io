---
layout:     post
title:    NextJS 全局中间件
subtitle:  
date:       2025-3-2
author:     
header-img: 
catalog: true
tags:
    - < node >
typora-root-url: ..
---



# NextJS 全局中间件

总结



[Nextjs 官方文档 - 中间件](https://next.nodejs.cn/docs/app/building-your-application/routing/middleware/)

#### 实现对 Nextjs 全局的 api 接口的权限校验

Step1：在项目根目录中创建 middleware.ts ，和 app 一个同级，即`src/middleware.ts`

Step2：声明各个中间件功能

```js
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

// This function can be marked `async` if using `await` inside
export function middleware(request: NextRequest) {
  return NextResponse.redirect(new URL('/home', request.url))
}

// See "Matching Paths" below to learn more
export const config = {
  matcher: '/about/:path*',
}
```

Step3：在哪些路径上运行

- 匹配器规则：必须以 `/` 开头；可以包含命名参数 `/about/:path`；修饰符 * + ? 正则 (.*)

```js
export const config = {
  matcher: '/about/:path*', // 特定路径
    // matcher: ['/about/:path*', '/dashboard/:path*'], 数组语法匹配单个路径或多个路径
    /** matcher: [
        {
          source:
            '/((?!api|_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt).*)',
          has: [{ type: 'header', key: 'x-present' }],
          missing: [{ type: 'header', key: 'x-missing', value: 'prefetch' }],
        }
    ] 通过 has missing 绕过某些请求的中间件 */
}
```





