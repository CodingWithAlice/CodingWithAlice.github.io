---
layout:     post
title:     06 输入url后，发生了什么
subtitle:  
date:       2021-04-21
author:     
header-img: 
catalog: true
tags:
    - < HTTP相关 >
typora-root-url: ..
---


# 06 输入url后，发生了什么

## 配合<浏览器原理>中的如下两篇博客食用

https://codingwithalice.github.io/2021/04/08/03-HTTP%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B/

https://codingwithalice.github.io/2021/04/08/04-%E5%AF%BC%E8%88%AA%E6%B5%81%E7%A8%8B-%E4%BB%8E%E8%BE%93%E5%85%A5url%E5%88%B0%E6%89%93%E5%BC%80%E9%A1%B5%E9%9D%A2%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/

用wireShark抓包，在地址栏输入 127.0.0.1 回车
![image-20210421145503018](/../img/assets_2019/image-20210421145503018.png)

抓包分析（没有DNS域名解析过程）：
1、通过浏览器输入的IP以及默认80端口，依照TCP协议，使用三次握手和WEB服务器建立连接

-   从图中可以看出，浏览器使用的端口是52085，服务端使用的端口是80，经过 SYN、SYN/ACK、ACK 的三个包之后，浏览器和服务器的TCP连接就建立了

2、有了TCP连接通道，浏览器就会按照HTTP协议，通过TCP发送一个`GET/HTTP/1.1`的报文

3、Web服务器收到报文后，会先回复一个`ACK`包，在TCP层面确认已收到报文

4、Web服务器接下来就会按照报文处理请求，根据HTTP协议将找到的文件读取出来，并拼接成符合HTTP格式的报文`HTTP/1.1 200 OK`，底层走的还是TCP协议

5、浏览器收到报文后，也会先回复一个`ACK`包

6、浏览器接下来就会解析报文

7、可以注意到后面还有两个来回，4个包 -- 是浏览器自动请求了网站图标`favicon.ico`，但是服务器没找到

图里 TCP 关闭连接的“四次挥手”在抓包里没有出现，这是因为 HTTP/1.1 长连接特性，默认不会立即关闭连接
<img src="/../img/assets_2019/image-20210421145614745.png" alt="image-20210421145614745" style="zoom:30%;" />

-   总结
1、HTTP 协议基于底层的 TCP/IP 协议，所以必须要用 IP 地址建立连接；
2、如果不知道 IP 地址，就要用 DNS 协议去解析得到 IP 地址，否则就会连接失败；
3、建立 TCP 连接后会顺序收发数据，请求方和应答方都必须依据 HTTP 规范构建和解析报文；
4、为了减少响应时间，整个过程中的每一个环节都会有缓存，能够实现“短路”操作；
5、虽然现实中的 HTTP 传输过程非常复杂，但理论上仍然可以简化成实验里的“两点”模型。

