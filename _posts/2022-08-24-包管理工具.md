---
layout:     post
title:     包管理工具
subtitle:  
date:       2022-08-24
author:     
header-img: 
catalog: true
tags:
    - < 工作遇到的问题记录 >
typora-root-url: ..
---



# 包管理工具

参考文章：[JavaScript package managers compared: npm, Yarn, or pnpm?](https://blog.logrocket.com/javascript-package-managers-compared/)

#### 背景：在工作遇到 

- （node14下）npm install + npm run build 会打包静态资源失败
- yarn + yarn build 成功
- 后尝试切换到 node 16 下，npm i + npm run build 成功

在我看来，`yarn build` 和 `npm run build` 都是执行 package.json 里面的 build 指令串，那么差异就落在了 install 依赖的时候，yarn 和 npm 是有差异的。

- 我看到工程里面，存在 yarn.lock 文件，而不存在 package.json 文件，认为 yarn 安装的文件限制了包版本不是 package 中的最高版本，所以不会报错；
- 但是我同事认为，是 yarn 和 npm 安装依赖的方式不同 -> 也就是引入文件存储的路径不同，导致打包的时候报一些引入文件的错误

我在网上查 yarn 和 npm 有什么区别，说的最多的是 speed，yarn 比 npm4.0  快很多，但是现在 npm 的版本已经升很高了，一些语义化指令也都支持了，速度也会快一些（具体快多少？在 yarn 出现后 npm 是不是也做了优化？）；

同时我也很想知道两种打包方式，引入包的路径究竟是不是有差异的，我遇到的这个问题，究竟是不是包路径的问题？

<img src="/img/assets_2019/:Users:haoling:Library:Application Support:typora-user-images:image-20220824212246863.png" alt="image-20220824212246863" style="zoom:87%;" />

在此基础上，我开始啃国外的文章（国内真的好千篇一律啊啊啊啊啊），参考文章写于 2022.02，还算比较新的。

### 以下为关键信息笔记

当今包管理器领域存在三个主要参与者：npm、Yarn（v1、v2）、pnpm（高性能 npm）

##### 共同点

功能对等；npm 和 Yarn 都将依赖安装在一个平面的 node_modules 中（pnpm引入了一些新概念）

##### 差异点

主要是安装速度、存储消耗、和项目工作流结匹配程度

##### 简要了解每个工具出现的原因

- npm 

  解决的是当时项目依赖是手动下载管理问题

- Yarn v1（又名 Yarn Classic） 

  是基于 npm 出现的，并行化操作加快了安装过程，针对的是 npm 早期版本的主要痛点

- pnpm 是 npm 的替代品，解决 npm 和 Yarn 在跨项目使用的依赖项冗余存储
  - （npm 和 yarn v1使用的是相同的依赖解析方法，都是使用提升来扁平化它们的 node_modules），pnpm 引入「内容可寻址存储」，生成一个嵌套 node_modules，保存在全局存储 ~/.pnpm-store/ 中，实现了依赖的每一个版本仅在该文件中进行一次物理存储 -> 构成单一来源，节省磁盘空间  

- Yarn v2（又名 Yarn Berry）主要创新是 即插即用（PnP方法，一个解决 node_modules 的策略） 

  缺点：需要更新，不兼容（添加一个配置开启 node_modules plugin 才可以使用传统的 node_modules 方法）

  - 它不创建 node_modules，而是生成一个带有依赖查找表的文件 .pnp.cjs（执行更快，因为单一文件快于嵌套的文件夹结构）

  - 此外在 .yarn/cache/ 文件夹中，每个包都是 zip 文件，占用磁盘空间较少 

##### 每种工具的安装方式

- npm 



